# zhaoli-oj-backend
本项目基于 Vue 3+Spring Boot + Spring Cloud 微服务 + Docker 的编程题目在线评测系统(简称 OJ)
## 后端技术栈
spring boot+mybatis+mybatis plus+redis+java-docker(后期使用spring cloud alibaba改造项目为微服务)
## 后端知识
- Java 进程控制 
- Java 安全管理器
- 部分 JVM 知识点 
- Docker（代码沙箱实现）
- Spring Cloud 微服务 
- 消息队列
  - rabbitmq消息队列
- 多种设计模式
  - 简单工厂设计模式、模板方法设计模式、策略模式、代理模式
## 核心业务
判题服务:获取题目信息、预计的输入输出结果，返回给主业务后端:用户的答案是否正确

代码沙箱:只负责运行代码，给出结果，不管什么结果是正确的。**实现解耦**
### 流程图
![img_1.png](doc%2Fimg_1.png)
### 时序图
![img_2.png](doc%2Fimg_2.png)

## 实现核心
1. 权限校验
- 谁能提代码，谁不能提代码
2. 代码沙箱(安全沙箱)
- 用户代码藏毒:写个木马文件、修改系统权限
- 沙箱:隔离的、安全的环境，用户的代码不会影响到沙箱之外的系统的运行
- 资源分配:系统的内存就2个G，用户疯狂占用资源占满你的内存，其他人就用不了了。所以要限制用户程序的占用资源。
3. 判题规则
- 题目用例的比对，结果的验证
4. 任务调度
- 服务器资源有限，用户要排队，按照顺序去依次执行判题，而不是直接拒绝

## 功能
1. 用户模块
- 注册
- 登录
2. 题目模块
- 创建题目(管理员)
- 删除题目(管理员)
- 修改题目(管理员)
- 搜索题目(用户)
- 在线做题
- 提交题目代码
3. 判题模块
- 提交判题(结果是否正确与错误)
- 错误处理(内存溢出、安全性、超时)
- **自主实现** 代码沙箱(安全沙箱)
- 开放接口(提供一个独立的新服务)

## 判题模块和代码沙箱的关系
- 判题模块:调用代码沙箱，把代码和输入交给代码沙箱去执行
- 代码沙箱:只负责接受代码和输入，返回编译运行的结果，不负责判题(可以作为独立的项目/服务，提供给其他的需要执行代码的项目去使用)
### 这两个模块完全解耦
![img_3.png](doc%2Fimg_3.png)
### 代码沙箱需要接受和输出一组运行用例
前提:我们的每道题目有多组测试用例<br>
如果是每个用例单独调用一次代码沙箱，会调用多次接口、需要多次网络传输、程序要多次编译、记录程序的执行状态(重复的代码不重复编译)<br>
这是一种很常见的性能优化方法!(批处理)
# 代码沙箱架构开发
- 定义代码沙箱的接口，提高通用性
  - 之后我们的项目代码只调用接口，不调用具体的实现类，这样在你使用其他的代码沙箱实现类时，就不用去修改名称了，便于扩展。